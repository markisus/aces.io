<head>
<link rel="stylesheet" href="{{static_url("css/pure-min.css")}}">
<link rel="stylesheet" href="{{static_url("css/client.css")}}">
<script src='{{static_url("js/ractive.js")}}'></script>
<script src='{{static_url("js/ractive-transitions-slidehorizontal.js")}}'></script>
<script src="{{ static_url("js/client.js")}}"></script>
</head>

<body>
  <h3>
    <button onclick="navigator.clipboard.writeText(window.location.href)">ðŸ“‹ Copy Game Address</button>
  </h3>  
  <div id="content" class="content"></div>

  <script>
    var images_dir = "{{ static_url("images/") }}";

    var ractive = undefined;
    fetch("{{static_url("js/client.mustache")}}")
    .then(response => response.text())
    .then(text => {
        ractive = initialize_ractive(text, images_dir);
    });
    
    var receive = function(msg) {
        var msg = JSON.parse(msg);
        console.log(msg)

        if (msg['warning']) {
            alert('warning: ' + msg['warning']);
        }
        if (msg['error']) {
            alert('error ' + msg['error'])
        }

        var action = msg['action'];
        if (action == "synchronize_game" && ractive) {
            ractive.set('game', msg.game);
            ractive.set('userid',  msg.userid);
        }
    }

    var send = game_connect("{{gameid}}", receive);

    setInterval(function() {
        console.log("Pinging")
        send({'action': 'ping'});
    }, 40000)
  </script>

</body>
